<div class="article-container container">
  @if (loading()) {
  <div class="loading-state">
    <div class="spinner"></div>
    <p>Loading article...</p>
  </div>
  } @if (error()) {
  <div class="error-state">
    <div class="error-icon">⚠️</div>
    <h2>Oops! Something went wrong</h2>
    <p>{{ error() }}</p>
  </div>
  } @if (article() && !loading() && !error()) {
  <article class="article-content">
    <header class="article-header">
      @if (article()?.image) {
      <div class="article-image-container">
        <img [src]="article()?.image" [alt]="article()?.title" loading="lazy" />
      </div>
      }
      <div class="article-title-box">
        <div class="article-meta">
          <span class="category">{{ article()?.category?.name }}</span>
          <span class="publish-date">{{
            article()?.publishedAt | date : "longDate"
          }}</span>
        </div>
        <h1 class="article-title">{{ article()?.title }}</h1>
        <div class="article-byline">
          <span class="author">{{ article()?.byline }}</span>
        </div>
      </div>
    </header>

    @if (article()?.highlight) {
    <div class="section-buttons top-section">
      <button
        class="content-btn highlight-btn"
        (click)="openModal('Article Highlight', article()?.highlight)"
      >
        View Article Highlight
      </button>
    </div>
    }

    <div class="article-body">
      <div class="content" [innerHTML]="getSafeHtml(article()?.content)"></div>
    </div>

    @if (article()?.teachingMomentsHighschool ||
    article()?.teachingMomentsMiddleschool ||
    article()?.directorMomentsHighschool ||
    article()?.directorMomentsMiddleschool || article()?.directorPodcast ||
    article()?.directorVlog) {

    <div class="moments-grid">
      @if (article()?.teachingMomentsHighschool) {
      <button
        class="grid-btn"
        (click)="
          openModal(
            'Teaching Moment - High School',
            article()?.teachingMomentsHighschool
          )
        "
      >
        Teaching Moment<br /><span>High School</span>
      </button>
      } @else {
      <div class="empty-cell"></div>
      } @if (article()?.teachingMomentsMiddleschool) {
      <button
        class="grid-btn"
        (click)="
          openModal(
            'Teaching Moment - Middle School',
            article()?.teachingMomentsMiddleschool
          )
        "
      >
        Teaching Moment<br /><span>Middle School</span>
      </button>
      } @else {
      <div class="empty-cell"></div>
      } @if (article()?.directorMomentsHighschool) {
      <button
        class="grid-btn director-btn"
        (click)="
          openModal(
            'Director’s Blog - High School',
            article()?.directorMomentsHighschool
          )
        "
      >
        Director Moment<br /><span>High School</span>
      </button>
      } @else {
      <div class="empty-cell"></div>
      } @if (article()?.directorMomentsMiddleschool) {
      <button
        class="grid-btn director-btn"
        (click)="
          openModal(
            'Director’s Blog - Middle School',
            article()?.directorMomentsMiddleschool
          )
        "
      >
        Director Moment<br /><span>Middle School</span>
      </button>
      } @else {
      <div class="empty-cell"></div>
      } @if (article()?.directorPodcast) {
      <button
        class="grid-btn media-btn"
        (click)="openModal('Director Podcast', article()?.directorPodcast)"
      >
        Director<br /><span>Podcast</span>
      </button>
      } @else {
      <div class="empty-cell"></div>
      } @if (article()?.directorVlog) {
      <button
        class="grid-btn media-btn"
        (click)="openModal('Director Vlog', article()?.directorVlog)"
      >
        Director<br /><span>Vlog</span>
      </button>
      } @else {
      <div class="empty-cell"></div>
      }
    </div>
    }

    <div class="section-buttons footer-buttons">
      @if (article()?.glossary) {
      <button
        class="content-btn"
        (click)="openModal('Glossary', article()?.glossary)"
      >
        Glossary
      </button>
      } @if (article()?.references) {
      <button
        class="content-btn"
        (click)="openModal('References', article()?.references)"
      >
        References
      </button>
      } @if (article()?.suggestedReading) {
      <button
        class="content-btn"
        (click)="openModal('Suggested Reading', article()?.suggestedReading)"
      >
        Suggested Reading
      </button>
      } @if (article()?.footnote) {
      <button
        class="content-btn"
        (click)="openModal('Footnotes', article()?.footnote)"
      >
        Footnotes
      </button>
      }
    </div>

    <footer class="article-footer">
      <div class="article-dates">
        <p>
          <strong>Published:</strong>
          {{ article()?.publishedAt | date : "longDate" }}
        </p>
        @if (article()?.updatedAt !== article()?.publishedAt) {
        <p>
          <strong>Last Updated:</strong>
          {{ article()?.updatedAt | date : "longDate" }}
        </p>
        }
      </div>
    </footer>
  </article>
  } @if (showModal) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ activeModalTitle }}</h2>
        <button class="close-btn" (click)="closeModal()">&times;</button>
      </div>

      <div class="modal-body">
        <div [innerHTML]="activeModalContent"></div>
      </div>

      <div class="modal-footer">
        <button class="action-btn doc-btn" (click)="downloadAsDocx()">
          Download as DOCX
        </button>
        <button class="action-btn pdf-btn" (click)="downloadAsPdf()">
          Download as PDF
        </button>
        <button class="action-btn close-action-btn" (click)="closeModal()">
          Close
        </button>
      </div>
    </div>
  </div>
  }
</div>

<app-got-covered></app-got-covered>
